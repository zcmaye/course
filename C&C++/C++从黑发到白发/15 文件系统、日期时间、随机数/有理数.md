# std::ratio

类模板 `std::ratio` 及相关的模板提供编译时有理数(整数和分数的集合)算术支持。此模板的每个实例化都准确表示任一有限有理数。

此模板的每个实例化都准确表示任一确定有理数，只要分子 `Num` 与分母 `Denom` 能表示为 [std::intmax_t](https://zh.cppreference.com/w/cpp/types/integer) 类型的编译时常量。另外， `Denom` 不可为零且不可等于最负的值。

约分分子和分母到最简。

```cpp
std::ratio<2, 10> r;
std::cout << r.num << std::endl;	//1
std::cout << r.den << std::endl;	//5
```

可以通过`type`类型获约分后的类型`std::ratio<2, 10>::type`

另外，如果分子分母都是负数，那么分子分母都将变为正整数。

```cpp
std::ratio<-2, -10> r;
std::cout << r.num << std::endl;	//1
std::cout << r.den << std::endl;	//5
```

还有，如果只有分子或分母中的一个是负数，那么负号将移到分子上。

```cpp
std::ratio<2, -10> r;
std::cout << r.num << std::endl;	//-1
std::cout << r.den << std::endl;	//5
```

标准库提供数个对应 SI( 国际单位制) ratio的方便别名 ：

```cpp
using atto  = ratio<1, 1000000000000000000LL>;
using femto = ratio<1, 1000000000000000LL>;
using pico  = ratio<1, 1000000000000LL>;
using nano  = ratio<1, 1000000000>;
using micro = ratio<1, 1000000>;
using milli = ratio<1, 1000>;
using centi = ratio<1, 100>;
using deci  = ratio<1, 10>;								//十分之一(一比十)
using deca  = ratio<10, 1>;								//十(十比一)
using hecto = ratio<100, 1>;
using kilo  = ratio<1000, 1>;
using mega  = ratio<1000000, 1>;
using giga  = ratio<1000000000, 1>;
using tera  = ratio<1000000000000LL, 1>;
using peta  = ratio<1000000000000000LL, 1>;
using exa   = ratio<1000000000000000000LL, 1>;
```

## 编译时有理数算术

提供数个别名模板，它们在编译时进行 `ratio` 实例上的算术。

| 在标头 `<ratio>` 定义                                        |                                          |
| ------------------------------------------------------------ | ---------------------------------------- |
| [ratio_add](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_add) | 在编译时相加两个 `ratio` 对象 (别名模板) |
| [ratio_subtract](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_subtract) | 在编译时相减两个 `ratio` 对象 (别名模板) |
| [ratio_multiply](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_multiply) | 在编译时相乘两个 `ratio` 对象 (别名模板) |
| [ratio_divide](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_divide) | 在编译时相除两个 `ratio` 对象 (别名模板) |

example：

```cpp
std::ratio_add<nano, micro>::type;
```

## 编译时有理数比较

提供数个类模板，它们在编译时进行 `ratio` 实例上的比较运算。

| 在标头 `<ratio>` 定义                                        |                                                          |
| ------------------------------------------------------------ | -------------------------------------------------------- |
| [ratio_equal](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_equal) | 在编译时比较两个 `ratio` 对象的相等性 (类模板)           |
| [ratio_not_equal](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_not_equal) | 在编译时比较两个 `ratio` 对象的不相等性 (类模板)         |
| [ratio_less](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_less) | 在编译时比较两个 `ratio` 对象的*小于*关系 (类模板)       |
| [ratio_less_equal](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_less_equal) | 在编译时比较两个 `ratio` 对象的*小于或等于*关系 (类模板) |
| [ratio_greater](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_greater) | 在编译时比较两个 `ratio` 对象的*大于*关系 (类模板)       |
| [ratio_greater_equal](https://zh.cppreference.com/w/cpp/numeric/ratio/ratio_greater_equal) | 在编译时比较两个 `ratio` 对象的*大于或等于*关系 (类模板) |

example：

```cpp
std::ratio_equal<std::ratio<10>, std::ratio<10>>::value;	//true
```

# std::chrno

chrno是C++日期时间库，以各种精度跟踪时间的类型的灵活汇集。

`chrono` 库定义三种主要类型以及工具函数和常用 using别名。

- `clock` 时钟
- `duration` 时长
- `time_point `时间点

## duration

### 定义对象

`std::chrono::duration` 表示时长，时长由时间跨度组成，定义为某时间单位的某个计次数。例如，“ 42 秒”可表示为由 42 个 1 秒时间点位的计次所组成的时长

`duration`类模板定义如下：

```cpp
template <class _Rep, class _Period = ratio<1,1>> 
class duration;
```

+ **_Rep：**表示一种数值类型，用来表示_Period的数量，比如int、float、double...

+ **_Period：**是`std::ratio`类型，用来表示（用秒表示的）单位，比如second、milisecond...

比如，想要表示一个秒数，代码如下：

```cpp
std::chrono::duration<long long,std::ratio<1,1>> mysec(10);			//mysec表示10秒
```

因为`duration`第二个模板默认值就是`std::ratio<1,1>`，所以还可以简写为如下形式：

```cpp
std::chrono::duration<long long> mysec(10);
```

如果想要表示分钟怎么办呢？

```cpp
std::chrono::duration<long long, std::ratio<1, 60>> myminute(10);	//myminute表示10分钟
```

上述代码中`std::ratio`比例为1/60，表示一分钟等于60秒。

### 辅助类型

其实不需要这么复杂，因为常用的时长类型已经被预定义好了！如下表所示：

| 类型                           | 定义                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| **std::chrono::nanoseconds**   | duration<long long, nano>                                    |
| **std::chrono::microseconds**  | duration<long long, micro>;                                  |
| **std::chrono::milliseconds**  | duration<long long, milli>;                                  |
| **std::chrono::seconds**       | duration<long long>;                                         |
| **std::chrono::minutes**       | duration<int, ratio<60>>;                                    |
| **std::chrono::hours**         | duration<int, ratio<3600>>;                                  |
| std::chrono::days (C++20 起)   | duration<int, ratio_multiply<ratio<24>, hours::period>>;     |
| std::chrono::weeks (C++20 起)  | duration<int, ratio_multiply<ratio<7>, days::period>>;       |
| std::chrono::months (C++20 起) | duration<int, ratio_multiply<ratio<146097, 400>, days::period>>; |
| std::chrono::years (C++20 起)  | duration<int, ratio_divide<years::period, ratio<12>>>;       |

用辅助类型定义对象就非常简单了！

```cpp
chrono::seconds longtime(60);		//60秒
chrono::days	mydays(30);			//30天
```

当然，其实有更方便的方法，C++为我们提供了字面量重载函数。

### 字面量
在内联命名空间 `std::literals::chrono_literals` 定义 
| 字面量函数        |                    含义                                |
| ------------------------------------------------------------ | -------------------------------------------------- |
| [operator""h](https://zh.cppreference.com/w/cpp/chrono/operator""h)(C++14) | 表示小时的 **std::chrono::duration** 字面量 (函数) |
| [operator""min](https://zh.cppreference.com/w/cpp/chrono/operator""min)(C++14) | 表示分钟的 **std::chrono::duration** 字面量 (函数) |
| [operator""s](https://zh.cppreference.com/w/cpp/chrono/operator""s)(C++14) | 表示秒的 **std::chrono::duration** 字面量 (函数)   |
| [operator""ms](https://zh.cppreference.com/w/cpp/chrono/operator""ms)(C++14) | 表示毫秒的 **std::chrono::duration** 字面量 (函数) |
| [operator""us](https://zh.cppreference.com/w/cpp/chrono/operator""us)(C++14) | 表示微秒的 **std::chrono::duration** 字面量 (函数) |
| [operator""ns](https://zh.cppreference.com/w/cpp/chrono/operator""ns)(C++14) | 表示纳秒的 **std::chrono::duration** 字面量 (函数) |

注意：字面量后缀 `d` 和 `y` 不指代 `days` 和 `years` ，而是分别指代 [`day`](https://zh.cppreference.com/w/cpp/chrono/day) 和 [`year`](https://zh.cppreference.com/w/cpp/chrono/year) 。  (C++20 起) 

```cpp
chrono::seconds longtime = 60s;
chrono::days	monthOfDays = 30d;	//error:“初始化”: 无法从“std::chrono::day”转换为“std::chrono::days”
```

### 成员函数

#### 获取计数

首先，我们来定义一个表示分钟的时长对象。

```cpp
chrono::minutes mins;
```

除了初始化之外，还可以给它赋值。

```cpp
mins = 20min;
```

要获取值，则可以通过成员函数`count`获取。

```cp
std::cout << mins << "  " << mins.count()  << std::endl;
```

运行结果为：`20min  20`

从上面可以看到，也能直接输出`duration`对象，只不过会加上单位作为后缀。如果输出的不是预定义的类型，则会有不一样的效果。

```cpp
std::cout << chrono::duration<long long, std::ratio<1, 20>>(5) << std::endl;
```

运行结果为：`5[1/20]s`

那么最大能表示多少分钟，最小能表示多分钟呢？可以通过下面的静态方法获取！

```cpp
std::cout << mins.zero() << " " << mins.min() << " " << mins.max() << std::endl;
```

运行结果为：`0min -2147483648min 2147483647min`

#### 转换

如果需要把分钟转成秒，则可以通过函数[duration_cast](https://zh.cppreference.com/w/cpp/chrono/duration/duration_cast)实现。

```cpp
auto s = chrono::duration_cast<chrono::seconds>(mins).count();
std::cout <<"20 minute is " << s << " seconds" << std::endl;
```

运行结果为：`20 minute is 1200 seconds`

下面代码把分钟转成小时：

```cpp
auto h = chrono::duration_cast<chrono::hours>(mins).count();
std::cout << "20 minute is " << h << " hours" << std::endl;
```

运行结果为：`20 minute is 0 hours`

咦！竟然是0小时？没错这个是没有小数部分的，那如果要不满一小时，算一小时怎么办呢？答案是使用`ceil`函数进行向上取整的转换。

```cpp
auto h = chrono::ceil<chrono::hours>(mins).count();
std::cout << "20 minute is " << h << " hours" << std::endl;
```

运行结果为：`20 minute is 1 hours`

同样还有向下取整函数`floor`、就近取整函数`round`。

如果你的时长是一个负值，还可以通过`abs`获取绝对值。

#### 算术运算

![image-20230728213839899](assets/image-20230728213839899.png)

## clock

时钟由起点（或纪元）及计次频率组成。例如，时钟可以拥有 1970 年 1 月 1 日的纪元，和每一秒的计次。 

C++ 定义数种时钟类型：



### system_clock

类 `std::chrono::system_clock` 表示系统范围的实时挂钟。

首先，获取当前时间。

```cpp
auto currentTime =  chrono::system_clock::now();
```

> system_clock是获取从协调世界时 (UTC) 1970 年 1 月 1 日星期四 00:00:00 开始的时间。

可以直接输出。

```cpp
std::cout << currentTime << std::endl;
```

运行结果为：`2023-07-28 14:20:15.4173841`

还提供了`to_time_t`和`from_time_t`函数，让系统时钟时间点和time_ti之间进行转换。

```cpp
//转换系统时钟时间点为time_t
time_t t = chrono::system_clock::to_time_t(currentTime);
//转换time_t到系统时钟时间点
auto nowTime = chrono::system_clock::from_time_t(time(nullptr));
```

注意：`chrono::system_clock::now();`函数返回的是一个时间点([time_point](#time_point))对象。

## time_point

时间点是从特定时钟的纪元开始经过的时间时长。

```cpp
chrono::system_clock::time_point nowTime =  chrono::system_clock::now();
```

可以通过函数获取自1970年以来开始的时长(chrono::system_clock::duration)(纳秒数)。

```cpp
std::cout << nowTime.time_since_epoch() << std::endl;
```

运行结果为：`16905550612558537[1/10000000]s`

https://www.coder.work/article/6593595