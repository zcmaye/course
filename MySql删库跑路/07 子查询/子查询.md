[简单易懂教你学会SQL关联子查询](https://zhuanlan.zhihu.com/p/41844742)

# 子查询

## 子查询概念

子查询指一个查询语句嵌套在另一个查询语句内部的查询，这个特性从 MySQL 4.1 开始引入。

在特定情况下，一个查询语句的条件需要另一个查询语句来获取，内层查询（inner query）语句的查询结果，可以为外层查询（outer query）语句提供查询条件。

> 内层查询即子查询，外层查询即主查询，只是叫法不同而已。

### **查询需求**

+ 查询公司之中工资最低的员工信息
  + 工资最低是多少？
  + 工资最低的员工是谁？

```mysql
SELECT * FROM emp WHERE sal=(SELECT MIN(sal) FROM emp);
```

### 子查询规范

1. 子查询必须放在小括号中
2. 子查询一般放在比较操作符的右边，以增强代码可读性
3. 子查询可以出现在几乎所有的SELECT字句中（如：SELECT、FROM、WHERE、ORDER BY、HAVING子句）



### 子查询分类

**根据子查询返回的数据分类**：

+ 标量子查询(scalar subquery)：返回1行1列一个值
+ 行子查询(row subquery)：返回的结果集是 1 行 N 列
+ 列子查询(column subquery)：返回的结果集是 N 行 1列
+ 表子查询(table subquery)：返回的结果集是 N 行 N 列

> 子查询可以返回一个标量(就一个值)、一个行、一个列或一个表，这些子查询分别称之为标量、行、列和表子查询。



**根据子查询和主查询之间是否有条件关联分类：**

+ 相关子查询：两个查询之间有一定的条件关联(相互联系)
+ 不相关子查询：两个查询之间没有条件关联(相互独立)



为了方便，对于在何处使用子查询给大家给出几点个人建议：

+ 子查询出现在**WHERE**子句中：此时子查询返回的结果一般都是单列单行、单行多列、多行单列
+ 子查询出现在**HAVING**子句中：此时子查询返回的都是单行单列数据，同时为了使用统计函数操作
+ 子查询出现在**FROM**子句中：此时子查询返回的结果图一般都是多行多列，可以按照一张数据表(临时表)的形式操作



## 标量子查询

> 子查询返回的是单行单列的数据，就是一个值

+ 查询出基本工资比ALLEN低的全部员工信息

```mysql
SELECT * FROM emp WHERE sal<(SELECT sal FROM emp WHERE eanme='ALLEN');
```

+ 查询基本工资高于公司平均工资的全部员工信息

```mysql
SELECT * FROM emp WHERE sal>(SELECT AVG(sal) FROM emp);
```

+ 查询出与ALLEN从事同一工作，并且基本工资高于员工编号为7521的全部员工信息

```mysql
SELECT * FROM emp WHERE job=(SELECT job FROM emp WHERE ename='ALLEN') 
AND sal>(SELECT sal FROM emp WHERE empno=7521)
#把ALLEN自己去掉
AND ename<>'ALLEN';
```



## 单行子查询

> 子查询返回的是单行多列的数据，就是一条记录

+ 查询与SCOTT从事统一工作且工资相同的员工信息

```mysql
SELECT * FROM emp WHERE (job,sal)=(SELECT job,sal FROM emp WHERE ename='SCOTT')
AND ename<>'SCOTT';
```

+ 查询与员工编号为7566从事统一工作且领导相同的全部员工信息

```mysql
SELECT * FROM emp WHERE (job,mgr)=(SELECT job,mgr FROM emp WHERE empno=7566)
AND emp<>7566;
```





## 列子查询(多行子查询)

> 子查询返回的是多行单列的数据，就是一列数据。多行子查询也称为集合比较子查询，

在使用多行子查询需要使用多行比较操作符：

| 操作符 | 含义                                                         |
| ------ | ------------------------------------------------------------ |
| IN     | 等于列表中的任意一个                                         |
| ANY    | 需要和单行比较操作符一起使用(>、<、=、<>...)，与子查询结果中任何一个值比较，一个成立 |
| ALL    | 需要和单行比较操作符一起使用(>、<、=、<>...)，和子查询返回的所有值比较，同时成立 |
| SOME   | 实际上是ANY的别名，作用相同，一般用ANY                       |



## 表子查询

[查询](https://www.cnblogs.com/geaozhang/p/6756825.html)