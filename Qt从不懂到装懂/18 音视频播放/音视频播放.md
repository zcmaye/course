[LAV filters](http://forum.doom9.org/showthread.php?t=156191)

## 播放内存中的音乐

```cpp
    QFile read("./music/Nevada.mp3");
    if (!read.open(QIODevice::ReadOnly))
    {
        qDebug() << "文件打开失败，请重试~";
    }
    //下面用的对象，必须动态申请，不然构造函数执行完毕，局部变量内存会被释放
    QByteArray *data = new QByteArray(read.readAll());
    read.close();

    QBuffer *buffer = new QBuffer(data，this);
    if (!buffer->open(QIODevice::ReadWrite))
    {
        qDebug() << "buffer error";
    }
    //qDebug() << data;
	QMediaPlayer *player = new QMediaPlayer(this);
    player->setMedia(QMediaContent()，buffer);
    player->play();
```

## 播放内存中的视频

```cpp
    QMediaPlayer *player = new QMediaPlayer(this);
    player->setMedia(QUrl("./music/MMD.mp4"));
    player->play();

    QVideoWidget* videowidget = new QVideoWidget(this);
    player->setVideoOutput(videowidget);
```

vs中如果提示编译器堆空间不足，则打开vcxproj工程文件，在PropertyGroup中添加如下代码

```cpp
<PropertyGroup Label="Globals">
    <!-- 资源文件加载，防止编译器堆空间不足 -->
     <PreferredToolArchitecture>x64</PreferredToolArchitecture> 
</PropertyGroup>
```



# 音视频播放

Qt对音视频的播放和控制﹑相机拍照，收音机等多媒体应用提供了强大的支持Qt 5使用了全新的Qt Multimedia模块来实现多媒体应用。Qt Multimedia模块提供了丰富的接口，使读者以轻松地使用平台的多媒体功能，例如，进行媒体播放﹑使用相机和收音机等。

C＋＋中多媒体模块可以实现的功能以及需要使用的C＋＋类如下表所示：

| 功能                     | 类                                               |
| ------------------------ | :----------------------------------------------- |
| 播放音效                 | QSoundEffect                                     |
| 播放低延迟音频           | QAudioOutput                                     |
| 播放编码音频(MP3、AAC等) | QMediaPlayer                                     |
| 访问原始音频输入数据     | QAudioInput                                      |
| 录制编码音频数据         | QAudioRecorder                                   |
| 发现原始音频设备         | QAudioDeviceInfo                                 |
| 播放视频                 | QMediaPlayer、QVideoWidget、QGraphicsVideoItem   |
| 处理视频                 | QMediaPlayer、QAbstractVideoSurface、QVideoFrame |
| 收听录音机               | QRadioTuner、QRadioData                          |
| 访问相机取景器           | QCamera、QVideoWidget、QGraphicsVideoItem        |
| 处理取景器               | QCamera、QAbstractVideoSurface、QVideoFrame      |
| 拍摄照片                 | QCamera、QCameraImageCapture                     |
| 拍摄视频                 | QCamera、QMediaRecorder                          |

## 播放音频

在Qt中，要想使计算机发出响声，最简单的方法是调用QApplication : : beep()静态函数。而Qt Multimedia模块中提供了多个类来实现不同层次的音频输入，输出和处理。

### QSoundEffect

QSoundEffect类提供了一种播放低延迟声音效果的方法 。

这个类允许你以较低的延迟方式播放未压缩的音频文件(通常是WAV文件)，并且适用于“反馈”类型的声音，以响应用户的动作(例如虚拟键盘声音，弹出对话框的正面或负面反馈，或游戏声音)。 如果低延迟不重要，可以考虑使用QMediaPlayer类，因为它支持更广泛的媒体格式，并且资源消耗更少。  

下面的例子展示了如何播放一个循环的，有点安静的声音效果：

```cpp
QSoundEffect effect;
effect.setSource(QUrl::fromLocalFile("F:/MyCode/QtObjectCode/QtCourse/soundeffect/video_call.wav"));
effect.setLoopCount(QSoundEffect::Infinite);
effect.setVolume(0.8f);
effect.play();
```

```cpp
//设置循环次数
void setLoopCount(int loopCount)
//是否静音
void setMuted(bool muted)
//设置wav路径
void setSource(const QUrl &url)
//设置音量0~1之间
void setVolume(qreal volume)
```

+ slots

```cpp
void play()	//播放
void stop()	//停止
```

### QMediaPlayer

QMediaPlayer类允许播放一个媒体源。  

```cpp
QMediaPlayer player;
player.setMedia(QUrl::fromLocalFile("F:/MyCode/QtObjectCode/QtCourse/soundeffect/That-Girl.mp3"));
player.setVolume(50);
player.play();
```

QVideoWidget可以与QMediaPlayer一起用于视频渲染，QMediaPlaylist用于访问播放列表功能。 

```cpp
QVideoWidget wid;
wid.show();

QMediaPlaylist playList;
playList.addMedia(QUrl::fromLocalFile("F:/MyCode/QtObjectCode/QtCourse/soundeffect/That-Girl.mp3"));
playList.addMedia(QUrl::fromLocalFile("F:/MyCode/QtObjectCode/QtCourse/soundeffect/干坤坤.mp4"));

QMediaPlayer player;
player.setPlaylist(&playList);
//player.setMedia(QUrl::fromLocalFile("F:/MyCode/QtObjectCode/QtCourse/soundeffect/That-Girl.mp3"));
player.setVolume(50);
playList.next();
player.setVideoOutput(&wid);
player.play();
```

+ **Public Functions**

```cpp
//该值是当前媒体的总播放时间，以毫秒为单位。 该值可能在QMediaPlayer对象的生命周期中发生变化，并且可能在初始回放开始时不可用，请连接到durationChanged()信号来接收状态通知。  
qint64 duration() const
//将QVideoWidget视频输出附加到媒体播放器。  
void setVideoOutput(QVideoWidget *output)
void setVideoOutput(QGraphicsVideoItem *output)
void setVideoOutput(QAbstractVideoSurface *surface)  
```

+ **Public Slots**

```cpp
//暂停播放当前源
void pause()	
//开始或恢复播放当前源    
void play()
//设置当前媒体源。 使用mediaStatusChanged()和error()信号，以便在加载媒体和加载过程中发生错误时得到通知      
void setMedia(const QMediaContent &media, QIODevice *stream = nullptr)
//设置静音    
void setMuted(bool muted)
//设置倍速播放
void setPlaybackRate(qreal rate)
//设置播放列表    
void setPlaylist(QMediaPlaylist *playlist)
//设置播放位置，以媒体开始后的毫秒数为单位。 位置的周期性变化将用信号positionChanged()表示，更新间隔可以用QMediaObject的方法setNotifyInterval()设置。    
void setPosition(qint64 position)
//此属性保存当前播放音量。  播放音量是线性缩放的，从0(静音)到100(全音量)。默认为100      
void setVolume(int volume)
//停止播放，并将播放位置重置到开始    
void stop()
```

+ **Signals**

```cpp
//表示当前播放内容已更改为media。  
void currentMediaChanged(const QMediaContent &media)
//表示内容的持续时间已更改为持续时间，以毫秒表示。  
void durationChanged(qint64 duration)    
//产生了错误
void error(QMediaPlayer::Error error)
//表示媒体来源已转变为media。      
void mediaChanged(const QMediaContent &media)
//表示当前媒体的状态已经改变    
void mediaStatusChanged(QMediaPlayer::MediaStatus status)
//静音状态改变  
void mutedChanged(bool muted)
//播放速率改变
void playbackRateChanged(qreal rate)
//播放位置改变    
void positionChanged(qint64 position)
//表示播放器对象的状态已经改变。  
void stateChanged(QMediaPlayer::State state)
//音量改变
void volumeChanged(int volume)
```



https://www.cnblogs.com/lxuechao/p/12677357.html